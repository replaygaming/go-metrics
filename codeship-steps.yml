- service: compile
  command: cp /go/bin/go-metrics /artifacts
  cached: true
  dockercfg_service: gcr_dockercfg

- service: dist
  command: true

- name: deployment
  service: dist
  type: parallel
  steps:
  - type: push
    image_name: us.gcr.io/replay-gaming/go-metrics
    image_tag: "c4900d1c2164a15ef64020c2b47e9697f18c445c"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg

  - type: push
    image_name: us.gcr.io/replay-gaming/go-metrics
    image_tag: "{{.Timestamp}}"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg

  - type: push
    image_name: us.gcr.io/replay-gaming/go-metrics
    image_tag: "{{.CommitID}}"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg
